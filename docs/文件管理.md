# JunoYi æ–‡ä»¶å­˜å‚¨æ¨¡å—

æ”¯æŒå¤šç§æ–‡ä»¶å­˜å‚¨æ–¹å¼çš„ç»Ÿä¸€æ–‡ä»¶ç®¡ç†æ¨¡å—ã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… ç»Ÿä¸€çš„æ–‡ä»¶æ“ä½œæ¥å£
- âœ… æ”¯æŒæœ¬åœ°å­˜å‚¨
- âœ… æ”¯æŒé˜¿é‡Œäº‘ OSS
- ğŸš§ æ”¯æŒ MinIOï¼ˆå¾…å®ç°ï¼‰
- ğŸš§ æ”¯æŒä¸ƒç‰›äº‘ï¼ˆå¾…å®ç°ï¼‰
- ğŸš§ æ”¯æŒè…¾è®¯äº‘ COSï¼ˆå¾…å®ç°ï¼‰
- âœ… ç­–ç•¥æ¨¡å¼è®¾è®¡ï¼Œæ˜“äºæ‰©å±•
- âœ… è‡ªåŠ¨æŒ‰æ—¥æœŸåˆ†ç›®å½•å­˜å‚¨
- âœ… æ–‡ä»¶ MD5 æ ¡éªŒ
- âœ… æ”¯æŒä¸´æ—¶è®¿é—® URL

## å¿«é€Ÿå¼€å§‹

### 1. æ·»åŠ ä¾èµ–

åœ¨ `pom.xml` ä¸­æ·»åŠ ï¼š

```xml
<dependency>
    <groupId>com.junoyi</groupId>
    <artifactId>junoyi-framework-file</artifactId>
</dependency>
```

### 2. é…ç½®æ–‡ä»¶

#### æœ¬åœ°å­˜å‚¨é…ç½®

```yaml
junoyi:
  file:
    storage-type: local  # å­˜å‚¨ç±»å‹
    domain: http://localhost:7588  # è®¿é—®åŸŸå
    local:
      base-path: ./upload  # æœ¬åœ°å­˜å‚¨æ ¹è·¯å¾„
      url-prefix: /files   # URLè·¯å¾„å‰ç¼€
```

#### é˜¿é‡Œäº‘ OSS é…ç½®

```yaml
junoyi:
  file:
    storage-type: aliyun-oss
    aliyun-oss:
      access-key-id: your-access-key-id
      access-key-secret: your-access-key-secret
      bucket-name: your-bucket-name
      endpoint: oss-cn-hangzhou.aliyuncs.com
      custom-domain: https://cdn.yourdomain.com  # å¯é€‰ï¼Œè‡ªå®šä¹‰åŸŸå
```

#### MinIO é…ç½®

```yaml
junoyi:
  file:
    storage-type: minio
    minio:
      endpoint: http://localhost:9000
      access-key: minioadmin
      secret-key: minioadmin
      bucket-name: junoyi
```

### 3. ä½¿ç”¨ç¤ºä¾‹

#### æ³¨å…¥ FileHelper

```java
@RestController
@RequestMapping("/file")
@RequiredArgsConstructor
public class FileController {

    private final FileHelper fileHelper;

    /**
     * ä¸Šä¼ æ–‡ä»¶
     */
    @PostMapping("/upload")
    public Result<FileInfo> upload(@RequestParam("file") MultipartFile file) {
        FileInfo fileInfo = fileHelper.upload(file);
        return Result.success(fileInfo);
    }

    /**
     * ä¸Šä¼ åˆ°æŒ‡å®šç›®å½•
     */
    @PostMapping("/upload/path")
    public Result<FileInfo> uploadToPath(
            @RequestParam("file") MultipartFile file,
            @RequestParam("path") String path) {
        FileInfo fileInfo = fileHelper.upload(file, path);
        return Result.success(fileInfo);
    }

    /**
     * ä¸‹è½½æ–‡ä»¶
     */
    @GetMapping("/download")
    public void download(@RequestParam("filePath") String filePath, 
                        HttpServletResponse response) throws IOException {
        byte[] data = fileHelper.download(filePath);
        response.setContentType("application/octet-stream");
        response.getOutputStream().write(data);
    }

    /**
     * åˆ é™¤æ–‡ä»¶
     */
    @DeleteMapping("/delete")
    public Result<Boolean> delete(@RequestParam("filePath") String filePath) {
        boolean success = fileHelper.delete(filePath);
        return Result.success(success);
    }

    /**
     * è·å–æ–‡ä»¶URL
     */
    @GetMapping("/url")
    public Result<String> getFileUrl(@RequestParam("filePath") String filePath) {
        String url = fileHelper.getFileUrl(filePath);
        return Result.success(url);
    }

    /**
     * è·å–ä¸´æ—¶è®¿é—®URLï¼ˆ1å°æ—¶æœ‰æ•ˆï¼‰
     */
    @GetMapping("/temp-url")
    public Result<String> getTempUrl(@RequestParam("filePath") String filePath) {
        String url = fileHelper.getFileUrl(filePath, 3600);
        return Result.success(url);
    }
}
```

## æ¶æ„è®¾è®¡

### æ ¸å¿ƒæ¥å£

```java
public interface FileStorage {
    FileInfo upload(MultipartFile file, String path);
    FileInfo upload(InputStream inputStream, String fileName, String path, String contentType);
    byte[] download(String filePath);
    boolean delete(String filePath);
    boolean exists(String filePath);
    String getFileUrl(String filePath);
    String getFileUrl(String filePath, long expireSeconds);
}
```

### å®ç°ç±»

- `LocalFileStorage` - æœ¬åœ°æ–‡ä»¶å­˜å‚¨
- `OssFileStorage` - é˜¿é‡Œäº‘ OSS å­˜å‚¨
- `MinioFileStorage` - MinIO å¯¹è±¡å­˜å‚¨ï¼ˆå¾…å®ç°ï¼‰
- `QiniuFileStorage` - ä¸ƒç‰›äº‘å­˜å‚¨ï¼ˆå¾…å®ç°ï¼‰

### å·¥å‚æ¨¡å¼

é€šè¿‡ `FileStorageFactory` æ ¹æ®é…ç½®åˆ›å»ºå¯¹åº”çš„å­˜å‚¨å®ç°ï¼Œæ”¯æŒè¿è¡Œæ—¶åŠ¨æ€åˆ‡æ¢ã€‚

## æ‰©å±•æ–°çš„å­˜å‚¨æ–¹å¼

1. å®ç° `FileStorage` æ¥å£
2. åœ¨ `FileStorageProperties` ä¸­æ·»åŠ é…ç½®ç±»
3. åœ¨ `FileStorageFactory` ä¸­æ·»åŠ åˆ›å»ºé€»è¾‘
4. åœ¨ `StorageType` æšä¸¾ä¸­æ·»åŠ æ–°ç±»å‹

ç¤ºä¾‹ï¼š

```java
public class CustomFileStorage implements FileStorage {
    // å®ç°æ¥å£æ–¹æ³•
}
```

## æ³¨æ„äº‹é¡¹

1. æœ¬åœ°å­˜å‚¨éœ€è¦ç¡®ä¿ç›®å½•æœ‰å†™å…¥æƒé™
2. OSS å­˜å‚¨éœ€è¦é…ç½®æ­£ç¡®çš„è®¿é—®å¯†é’¥
3. æ–‡ä»¶ä¼šè‡ªåŠ¨æŒ‰æ—¥æœŸåˆ†ç›®å½•å­˜å‚¨ï¼ˆå¹´/æœˆ/æ—¥ï¼‰
4. å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ OSS ç­‰äº‘å­˜å‚¨
5. ä¸´æ—¶ URL ä»… OSS ç­‰äº‘å­˜å‚¨æ”¯æŒ

## æœ€ä½³å®è·µ

1. **å¼€å‘ç¯å¢ƒ**ï¼šä½¿ç”¨æœ¬åœ°å­˜å‚¨ï¼Œæ–¹ä¾¿è°ƒè¯•
2. **ç”Ÿäº§ç¯å¢ƒ**ï¼šä½¿ç”¨ OSS/MinIO ç­‰äº‘å­˜å‚¨ï¼Œæé«˜å¯é æ€§
3. **æ–‡ä»¶åˆ†ç±»**ï¼šé€šè¿‡ path å‚æ•°å¯¹ä¸åŒç±»å‹æ–‡ä»¶åˆ†ç›®å½•å­˜å‚¨
4. **å®‰å…¨æ€§**ï¼šæ•æ„Ÿæ–‡ä»¶ä½¿ç”¨ä¸´æ—¶ URLï¼Œè®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´
5. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¤§æ–‡ä»¶ä¸Šä¼ å»ºè®®ä½¿ç”¨åˆ†ç‰‡ä¸Šä¼ ï¼ˆåç»­æ”¯æŒï¼‰

## ç‰ˆæœ¬å†å²

- v0.3.4-alpha - åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒæœ¬åœ°å­˜å‚¨å’Œé˜¿é‡Œäº‘ OSS
