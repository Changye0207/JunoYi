# 前端字典标签颜色使用指南

## 概述

本文档说明如何在前端使用字典数据中的 `listClass` 字段来渲染带颜色的 Element Plus 标签组件。

## 后端返回数据结构

字典 API 返回的数据结构包含 `listClass` 字段，用于指定标签的颜色类型：

```json
{
  "dictCode": 1,
  "dictLabel": "男",
  "dictValue": "0",
  "dictType": "sys_user_sex",
  "listClass": "primary",
  "status": "0",
  "dictSort": 1
}
```

## listClass 字段说明

`listClass` 字段对应 Element Plus 的 ElTag 组件的 `type` 属性，支持以下值：

| listClass 值 | 颜色效果 | 常用场景 |
|-------------|---------|---------|
| `primary` | 蓝色 | 主要状态、默认选项 |
| `success` | 绿色 | 成功、正常、启用 |
| `info` | 灰色 | 信息、中性状态 |
| `warning` | 橙色 | 警告、待处理 |
| `danger` | 红色 | 危险、错误、停用 |
| `""` (空字符串) | 默认灰色 | 无特殊样式 |

## 前端使用示例

### 1. 基础用法 - 直接使用字典数据

```vue
<template>
  <el-table :data="tableData">
    <el-table-column prop="sex" label="性别">
      <template #default="{ row }">
        <el-tag :type="getSexTag(row.sex).type">
          {{ getSexTag(row.sex).label }}
        </el-tag>
      </template>
    </el-table-column>
  </el-table>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { getDictDataByType } from '@/api/system/dict'

const tableData = ref([])
const sexDict = ref([])

// 获取字典数据
onMounted(async () => {
  const res = await getDictDataByType('sys_user_sex')
  sexDict.value = res.data
})

// 根据字典值获取标签信息
const getSexTag = (value) => {
  const dict = sexDict.value.find(item => item.dictValue === value)
  return {
    label: dict?.dictLabel || value,
    type: dict?.listClass || ''
  }
}
</script>
```

### 2. 使用 Composable 封装（推荐）

创建 `src/composables/useDict.js`：

```javascript
import { ref, onMounted } from 'vue'
import { getDictDataByType } from '@/api/system/dict'

/**
 * 字典数据 Hook
 * @param {string} dictType - 字典类型
 * @returns {Object} 字典相关方法和数据
 */
export function useDict(dictType) {
  const dictData = ref([])
  const loading = ref(false)

  // 加载字典数据
  const loadDict = async () => {
    loading.value = true
    try {
      const res = await getDictDataByType(dictType)
      dictData.value = res.data || []
    } catch (error) {
      console.error(`Failed to load dictionary: ${dictType}`, error)
      dictData.value = []
    } finally {
      loading.value = false
    }
  }

  // 根据字典值获取标签
  const getDictLabel = (value) => {
    const dict = dictData.value.find(item => item.dictValue === value)
    return dict?.dictLabel || value
  }

  // 根据字典值获取标签颜色类型
  const getDictType = (value) => {
    const dict = dictData.value.find(item => item.dictValue === value)
    return dict?.listClass || ''
  }

  // 根据字典值获取完整字典项
  const getDictItem = (value) => {
    return dictData.value.find(item => item.dictValue === value)
  }

  // 获取标签渲染信息（包含 label 和 type）
  const getDictTag = (value) => {
    const dict = dictData.value.find(item => item.dictValue === value)
    return {
      label: dict?.dictLabel || value,
      type: dict?.listClass || ''
    }
  }

  onMounted(() => {
    loadDict()
  })

  return {
    dictData,
    loading,
    loadDict,
    getDictLabel,
    getDictType,
    getDictItem,
    getDictTag
  }
}
```

### 3. 在组件中使用 Composable

```vue
<template>
  <el-table :data="userList" v-loading="loading">
    <!-- 性别列 -->
    <el-table-column prop="sex" label="性别" width="100">
      <template #default="{ row }">
        <el-tag :type="sexDict.getDictType(row.sex)">
          {{ sexDict.getDictLabel(row.sex) }}
        </el-tag>
      </template>
    </el-table-column>

    <!-- 状态列 -->
    <el-table-column prop="status" label="状态" width="100">
      <template #default="{ row }">
        <el-tag :type="statusDict.getDictType(row.status)">
          {{ statusDict.getDictLabel(row.status) }}
        </el-tag>
      </template>
    </el-table-column>
  </el-table>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { useDict } from '@/composables/useDict'
import { getUserList } from '@/api/system/user'

const userList = ref([])
const loading = ref(false)

// 使用字典
const sexDict = useDict('sys_user_sex')
const statusDict = useDict('sys_common_status')

// 加载用户列表
onMounted(async () => {
  loading.value = true
  try {
    const res = await getUserList()
    userList.value = res.data
  } finally {
    loading.value = false
  }
})
</script>
```

### 4. 创建通用字典标签组件

创建 `src/components/DictTag/index.vue`：

```vue
<template>
  <el-tag :type="tagType" :effect="effect" :size="size">
    {{ tagLabel }}
  </el-tag>
</template>

<script setup>
import { computed } from 'vue'
import { useDict } from '@/composables/useDict'

const props = defineProps({
  // 字典类型
  dictType: {
    type: String,
    required: true
  },
  // 字典值
  value: {
    type: [String, Number],
    required: true
  },
  // 标签效果
  effect: {
    type: String,
    default: 'light' // light | dark | plain
  },
  // 标签尺寸
  size: {
    type: String,
    default: 'default' // large | default | small
  }
})

const dict = useDict(props.dictType)

const tagLabel = computed(() => dict.getDictLabel(String(props.value)))
const tagType = computed(() => dict.getDictType(String(props.value)))
</script>
```

使用通用组件：

```vue
<template>
  <el-table :data="userList">
    <el-table-column prop="sex" label="性别">
      <template #default="{ row }">
        <dict-tag dict-type="sys_user_sex" :value="row.sex" />
      </template>
    </el-table-column>

    <el-table-column prop="status" label="状态">
      <template #default="{ row }">
        <dict-tag dict-type="sys_common_status" :value="row.status" />
      </template>
    </el-table-column>
  </el-table>
</template>

<script setup>
import DictTag from '@/components/DictTag'
// ... 其他代码
</script>
```

### 5. 表单中使用字典（下拉选择）

```vue
<template>
  <el-form :model="form">
    <el-form-item label="性别" prop="sex">
      <el-select v-model="form.sex" placeholder="请选择性别">
        <el-option
          v-for="item in sexDict.dictData.value"
          :key="item.dictValue"
          :label="item.dictLabel"
          :value="item.dictValue"
        >
          <el-tag :type="item.listClass" size="small">
            {{ item.dictLabel }}
          </el-tag>
        </el-option>
      </el-select>
    </el-form-item>

    <el-form-item label="状态" prop="status">
      <el-radio-group v-model="form.status">
        <el-radio
          v-for="item in statusDict.dictData.value"
          :key="item.dictValue"
          :label="item.dictValue"
        >
          <el-tag :type="item.listClass" size="small">
            {{ item.dictLabel }}
          </el-tag>
        </el-radio>
      </el-radio-group>
    </el-form-item>
  </el-form>
</template>

<script setup>
import { reactive } from 'vue'
import { useDict } from '@/composables/useDict'

const form = reactive({
  sex: '',
  status: ''
})

const sexDict = useDict('sys_user_sex')
const statusDict = useDict('sys_common_status')
</script>
```

## 字典 API 接口说明

### 获取字典数据

```javascript
// API 定义 (src/api/system/dict.js)
import request from '@/utils/request'

/**
 * 根据字典类型获取字典数据
 * @param {string} dictType - 字典类型
 */
export function getDictDataByType(dictType) {
  return request({
    url: `/system/dict/data/type/${dictType}`,
    method: 'get'
  })
}

/**
 * 批量获取多个字典类型的数据
 * @param {Array<string>} dictTypes - 字典类型数组
 */
export function getDictDataByTypes(dictTypes) {
  return request({
    url: '/system/dict/data/types',
    method: 'post',
    data: dictTypes
  })
}
```

## 系统内置字典类型

| 字典类型 | 说明 | 常用值 |
|---------|------|--------|
| `sys_user_sex` | 用户性别 | 0-男, 1-女, 2-未知 |
| `sys_user_status` | 用户状态 | 0-正常, 1-停用 |
| `sys_dept_status` | 部门状态 | 0-正常, 1-停用 |
| `sys_role_status` | 角色状态 | 0-正常, 1-停用 |
| `sys_menu_status` | 菜单状态 | 0-正常, 1-停用 |
| `sys_menu_type` | 菜单类型 | M-目录, C-菜单, F-按钮 |
| `sys_common_status` | 通用状态 | 0-正常, 1-停用 |
| `sys_yes_no` | 是否 | Y-是, N-否 |
| `sys_show_hide` | 显示隐藏 | 0-显示, 1-隐藏 |
| `sys_data_scope` | 数据范围 | 1-全部, 2-自定义, 3-本部门, 4-本部门及以下, 5-仅本人 |
| `sys_login_type` | 登录类型 | password-密码, sms-短信, email-邮箱 |
| `sys_device_type` | 设备类型 | pc-电脑, mobile-手机, tablet-平板 |
| `sys_log_level` | 日志级别 | info-信息, warn-警告, error-错误 |
| `sys_oper_type` | 操作类型 | query-查询, add-新增, update-修改, delete-删除等 |
| `sys_oper_module` | 操作模块 | user-用户, role-角色, dept-部门等 |

## 最佳实践

### 1. 全局字典缓存

在应用启动时预加载常用字典到 Vuex/Pinia：

```javascript
// stores/dict.js
import { defineStore } from 'pinia'
import { getDictDataByTypes } from '@/api/system/dict'

export const useDictStore = defineStore('dict', {
  state: () => ({
    dictMap: {} // { dictType: [dictData] }
  }),

  actions: {
    // 批量加载字典
    async loadDicts(dictTypes) {
      const res = await getDictDataByTypes(dictTypes)
      this.dictMap = { ...this.dictMap, ...res.data }
    },

    // 获取字典数据
    getDictData(dictType) {
      return this.dictMap[dictType] || []
    },

    // 获取字典标签
    getDictLabel(dictType, value) {
      const dict = this.getDictData(dictType).find(
        item => item.dictValue === value
      )
      return dict?.dictLabel || value
    },

    // 获取字典类型（颜色）
    getDictType(dictType, value) {
      const dict = this.getDictData(dictType).find(
        item => item.dictValue === value
      )
      return dict?.listClass || ''
    }
  }
})

// 在 main.js 中预加载
import { useDictStore } from '@/stores/dict'

const app = createApp(App)
app.use(pinia)

const dictStore = useDictStore()
dictStore.loadDicts([
  'sys_user_sex',
  'sys_common_status',
  'sys_menu_type',
  'sys_yes_no'
])
```

### 2. 字典过滤器（可选）

如果使用 Vue 2 或需要在模板中直接使用：

```javascript
// utils/dict-filter.js
import { useDictStore } from '@/stores/dict'

export function dictLabel(value, dictType) {
  const dictStore = useDictStore()
  return dictStore.getDictLabel(dictType, value)
}

export function dictType(value, dictType) {
  const dictStore = useDictStore()
  return dictStore.getDictType(dictType, value)
}

// 在组件中使用
import { dictLabel, dictType } from '@/utils/dict-filter'

const label = dictLabel('0', 'sys_user_sex') // "男"
const type = dictType('0', 'sys_user_sex') // "primary"
```

### 3. TypeScript 类型定义

```typescript
// types/dict.ts
export interface DictData {
  dictCode: number
  dictLabel: string
  dictValue: string
  dictType: string
  dictSort: number
  cssClass: string
  listClass: 'primary' | 'success' | 'info' | 'warning' | 'danger' | ''
  isDefault: 'Y' | 'N'
  status: '0' | '1'
  remark?: string
  createTime?: string
  updateTime?: string
}

export interface DictTag {
  label: string
  type: 'primary' | 'success' | 'info' | 'warning' | 'danger' | ''
}
```

## 注意事项

1. **后端已返回 listClass**：后端 API 已经包含 `listClass` 字段，前端直接使用即可
2. **缓存机制**：后端使用 Redis 缓存字典数据，性能已优化
3. **状态过滤**：后端只返回启用状态（status='0'）的字典数据
4. **空值处理**：如果 `listClass` 为空字符串，ElTag 会显示默认灰色
5. **实时更新**：字典数据修改后，后端会自动刷新缓存，前端建议在必要时重新加载

## 效果预览

使用 `listClass` 字段后，不同状态会显示不同颜色的标签：

- 正常/启用：绿色（success）
- 停用/禁用：红色（danger）
- 警告/待处理：橙色（warning）
- 信息/默认：蓝色（primary）或灰色（info）

这样可以让用户一眼就能识别不同的状态，提升用户体验。
